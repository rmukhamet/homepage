<!doctype html><html lang=ru><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Golang Help</title><style>html body{font-family:raleway,sans-serif;background-color:#fff}:root{--accent: magenta;--border-width:  5px }</style><link rel=stylesheet href=https://rmukhamet.ru/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/kotlin.min.js></script><script>hljs.initHighlightingOnLoad();</script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script>$(document).on('click',function(){$('.collapse').collapse('hide');})</script><meta name=generator content="Hugo 0.69.2"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-35259440-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)};gtag('js',new Date());gtag('config','UA-35259440-2');</script><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></head><body><nav class="navbar navbar-default navbar-fixed-top"><div class=container><div class=navbar-header><a class="navbar-brand visible-xs" href=#>Golang Help</a>
<button class=navbar-toggle data-target=.navbar-collapse data-toggle=collapse>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href=/>Главная</a></li><li><a href=/about/>Обо мне</a></li><li><a href=/quotas/>Цитаты</a></li><li><a href=/vital-maxims/>Принципы</a></li><li><a href=/golang/>Golang Help</a></li><li><a href=/vim/>Vim help</a></li><li><a href=/tags/>Теги</a></li><li><a href=/categories/>Категории</a></li><li><a href=https://github.com/rmukhamet/cv/releases/latest/download/CV_Rafael_Mukhametdzhanov.pdf>CV</a></li></ul><ul class="nav navbar-nav navbar-right"><li class=navbar-icon><a href=https://twitter.com/RMukhamet><i class="fa fa-twitter"></i></a></li><li class=navbar-icon><a href=https://github.com/rmukhamet><i class="fa fa-github"></i></a></li><li class=navbar-icon><a href=https://www.instagram.com/rafaelfyaritovich/><i class="fa fa-instagram"></i></a></li><li class=navbar-icon><a href=https://www.facebook.com/rmukhametdzhanov><i class="fa fa-facebook"></i></a></li><li class=navbar-icon><a href=https://www.strava.com/athletes/rmukhamet><i class="fa fa-strava"></i></a></li><li class=navbar-icon><a href=https://www.linkedin.com/in/rafaelmoukhametdjanov/><i class="fa fa-linkedin"></i></a></li><li class=navbar-icon><a href=https://t.me/rmukhamet><i class="fa fa-telegram"></i></a></li><li class=navbar-icon><a href=mailto:rmukhametdzhanov@gmail.com><i class="fa fa-envelope-o"></i></a></li></ul></div></div></nav><main><div><h2>Golang Help</h2><h5>golang help</h5></div><div align=start class=content><h2 id=benchmark>benchmark</h2><h3 id=profiling>profiling</h3><p><a href=https://blog.golang.org/pprof>source</a>
go test -bench=. -benchmem -cpuprofile=cpu.out -memprofile=mem.out bench_test.go</p><p>go tool pprof -alloc_space mem.cputest mem.out
(pprof) list &lsquo;func name&rsquo;</p><p>go build -gcflags &ldquo;-m -m&rdquo;</p><h3 id=benchcmp>benchcmp</h3><p><code>go test -bench=. -benchmem bench_test.go > new.txt</code>
git stash
<code>go test -bench=. -benchmem bench_test.go > old.txt</code>
<code>benchcmp old.txt new.txt</code></p><pre><code>benchmark old ns/op new ns/op delta
BenchmarkToJSON 1579 495 -68.65%
</code></pre><p>benchmark old MB/s new MB/s speedup
BenchmarkToJSON 12.66 46.41 3.67x</p><p>benchmark old allocs new allocs delta
BenchmarkToJSON 2 2 +0.00%</p><p>benchmark old bytes new bytes delta
BenchmarkToJSON 184 48 -73.91%</p><h2 id=debuger>debuger</h2><p>TODO delve</p></div></main><footer><p class="copyright text-muted">Rafael 2020</p></footer></body></html>